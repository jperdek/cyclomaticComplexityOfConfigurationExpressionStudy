package astFileProcessor.processors.cyclomaticComplexity;

import java.io.IOException;

import org.json.simple.JSONArray;
import org.json.simple.JSONObject;

import astFileProcessor.annotationManagment.astConstructs.NotFoundBlockElementToWrap;
import unsupportedDecoratorsManagement.NonExistingDecoratorTransformationType;
import unsupportedDecoratorsManagement.entities.IllegalImportNameSpecifiedException;


public class ASTCyclomaticTransformationProcessor {

	private ExpressionsForCyclomaticComplexityManipulationSettings expressionsForCyclomaticComplexityManipulationSettings;
	
	
	public ASTCyclomaticTransformationProcessor() {
	}
	
	public void transformVariabilityAnnotations(JSONObject astRoot, 
			ExpressionsForCyclomaticComplexityManipulationSettings expressionsForCyclomaticComplexityManipulationSettings) 
			throws NonExistingDecoratorTransformationType, IOException, InterruptedException, 
			       IllegalImportNameSpecifiedException, NotFoundBlockElementToWrap {
		this.expressionsForCyclomaticComplexityManipulationSettings = expressionsForCyclomaticComplexityManipulationSettings;
		this.transformVariabilityAnnotations(astRoot, astRoot);
	}
	
	public void transformVariabilityAnnotations(JSONObject astElement, JSONObject astParent) {
		String key;
		if (astElement == null) { return; }

		Object entryValue;
		JSONObject entryJSONObject;
		JSONArray contextArray;
		for(Object entryKey: astElement.keySet()) {
			key = (String) entryKey;
			entryValue = astElement.get(key);
			//if (key.equals("illegalDecorators")) {	continue; }
			if (entryValue instanceof JSONObject) {
				entryJSONObject = (JSONObject) entryValue;
				this.transformVariabilityAnnotations(entryJSONObject, astElement);
			} else if(entryValue instanceof JSONArray) {	
				contextArray = (JSONArray) entryValue;
				
				for (int index = 0; index < contextArray.size(); index++) {
					entryJSONObject = (JSONObject) contextArray.get(index);
	
					this.transformVariabilityAnnotations(entryJSONObject, astElement);
				}
			}
		}
	}
}
